(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{411:function(t,a,s){"use strict";s.r(a);var e=s(15),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("你好呀，我的老朋友！我是老寇，欢迎来到老寇IoT云平台！")]),t._v(" "),a("p",[t._v("本文档详细介绍了基于 "),a("code",[t._v("OAuth2ResourceServerProperties")]),t._v(" 的配置。")]),t._v(" "),a("h2",{attrs:{id:"配置前缀"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置前缀"}},[t._v("#")]),t._v(" 配置前缀")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 所有配置项都在此前缀下")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"_1-配置概览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置概览"}},[t._v("#")]),t._v(" 1. 配置概览")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request-matcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ignore-patterns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# HTTP方法:")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   - 路径模式=服务名")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"_2-配置项说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置项说明"}},[t._v("#")]),t._v(" 2. 配置项说明")]),t._v(" "),a("h3",{attrs:{id:"基础配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础配置"}},[t._v("#")]),t._v(" 基础配置")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("配置项")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("默认值")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("enabled")])]),t._v(" "),a("td",[a("code",[t._v("boolean")])]),t._v(" "),a("td",[a("code",[t._v("true")])]),t._v(" "),a("td",[t._v("是否启用 OAuth2 资源服务器")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("request-matcher.ignore-patterns")])]),t._v(" "),a("td",[a("code",[t._v("Map<String, Set<String>>")])]),t._v(" "),a("td",[a("code",[t._v("{}")])]),t._v(" "),a("td",[t._v("按 HTTP 方法分组的忽略认证路径")])])])]),t._v(" "),a("h3",{attrs:{id:"ignore-patterns-格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ignore-patterns-格式"}},[t._v("#")]),t._v(" ignore-patterns 格式")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request-matcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ignore-patterns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("HTTP方法")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 路径模式=服务名\n")])])]),a("blockquote",[a("p",[t._v("[!IMPORTANT]")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("HTTP 方法")]),t._v(": "),a("code",[t._v("GET")]),t._v("、"),a("code",[t._v("POST")]),t._v("、"),a("code",[t._v("PUT")]),t._v("、"),a("code",[t._v("DELETE")]),t._v("、"),a("code",[t._v("HEAD")]),t._v("、"),a("code",[t._v("PATCH")])]),t._v(" "),a("li",[a("strong",[t._v("路径模式")]),t._v(": 支持 Ant 风格通配符（"),a("code",[t._v("*")]),t._v("、"),a("code",[t._v("**")]),t._v("、"),a("code",[t._v("?")]),t._v("）")]),t._v(" "),a("li",[a("strong",[t._v("服务名")]),t._v(": 必须与 "),a("code",[t._v("spring.application.name")]),t._v(" 一致")])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_3-实际配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-实际配置"}},[t._v("#")]),t._v(" 3. 实际配置")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SERVICE_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request-matcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ignore-patterns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v3/api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docs/"),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("**=laokou-auth")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /actuator/"),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("**=laokou-auth")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /error=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("uuid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/secrets=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /doc.html=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /webjars/"),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("**=laokou-auth")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("POST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/send/mail=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/send/mobile=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DELETE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/tokens=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"_4-忽略认证的端点详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-忽略认证的端点详解"}},[t._v("#")]),t._v(" 4. 忽略认证的端点详解")]),t._v(" "),a("h3",{attrs:{id:"get-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#get-请求"}},[t._v("#")]),t._v(" GET 请求")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("路径")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("用途")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("/v3/api-docs/**")])]),t._v(" "),a("td",[t._v("OpenAPI 文档")]),t._v(" "),a("td",[t._v("Swagger/Knife4j API 文档")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/actuator/**")])]),t._v(" "),a("td",[t._v("Actuator 端点")]),t._v(" "),a("td",[t._v("健康检查、监控指标")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/error")])]),t._v(" "),a("td",[t._v("错误页面")]),t._v(" "),a("td",[t._v("全局异常处理")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/v1/captchas/{uuid}")])]),t._v(" "),a("td",[t._v("获取验证码")]),t._v(" "),a("td",[t._v("图形验证码获取")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/v1/secrets")])]),t._v(" "),a("td",[t._v("获取密钥")]),t._v(" "),a("td",[t._v("加密公钥获取")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/doc.html")])]),t._v(" "),a("td",[t._v("Knife4j 文档")]),t._v(" "),a("td",[t._v("API 文档页面")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/webjars/**")])]),t._v(" "),a("td",[t._v("静态资源")]),t._v(" "),a("td",[t._v("Swagger UI 资源文件")])])])]),t._v(" "),a("h3",{attrs:{id:"post-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#post-请求"}},[t._v("#")]),t._v(" POST 请求")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("路径")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("用途")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("/v1/captchas/send/mail")])]),t._v(" "),a("td",[t._v("发送邮箱验证码")]),t._v(" "),a("td",[t._v("邮箱登录验证码")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/v1/captchas/send/mobile")])]),t._v(" "),a("td",[t._v("发送手机验证码")]),t._v(" "),a("td",[t._v("手机登录验证码")])])])]),t._v(" "),a("h3",{attrs:{id:"delete-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#delete-请求"}},[t._v("#")]),t._v(" DELETE 请求")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("路径")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("用途")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("/v1/tokens")])]),t._v(" "),a("td",[t._v("注销令牌")]),t._v(" "),a("td",[t._v("用户登出")])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_5-路径匹配模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-路径匹配模式"}},[t._v("#")]),t._v(" 5. 路径匹配模式")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("模式")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("示例匹配")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("*")])]),t._v(" "),a("td",[t._v("单级任意字符")]),t._v(" "),a("td",[a("code",[t._v("/api/*")]),t._v(" 匹配 "),a("code",[t._v("/api/users")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("**")])]),t._v(" "),a("td",[t._v("多级任意路径")]),t._v(" "),a("td",[a("code",[t._v("/api/**")]),t._v(" 匹配 "),a("code",[t._v("/api/a/b/c")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("{var}")])]),t._v(" "),a("td",[t._v("路径变量")]),t._v(" "),a("td",[a("code",[t._v("/captchas/{uuid}")]),t._v(" 匹配 "),a("code",[t._v("/captchas/abc123")])])])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_6-配置示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置示例"}},[t._v("#")]),t._v(" 6. 配置示例")]),t._v(" "),a("h3",{attrs:{id:"示例-1-添加新的公开-get-端点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-1-添加新的公开-get-端点"}},[t._v("#")]),t._v(" 示例 1：添加新的公开 GET 端点")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request-matcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ignore-patterns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v3/api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("docs/"),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("**=laokou-auth")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /actuator/"),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("**=laokou-auth")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("uuid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新增：公开配置接口")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/configs/public=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n")])])]),a("h3",{attrs:{id:"示例-2-添加新的公开-post-端点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-2-添加新的公开-post-端点"}},[t._v("#")]),t._v(" 示例 2：添加新的公开 POST 端点")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request-matcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ignore-patterns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("POST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/send/mail=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/send/mobile=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新增：用户注册")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/users/register=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n")])])]),a("h3",{attrs:{id:"示例-3-多服务共享配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-3-多服务共享配置"}},[t._v("#")]),t._v(" 示例 3：多服务共享配置")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request-matcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ignore-patterns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 多服务共享健康检查")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /actuator/health=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 仅 auth 服务")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("uuid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n")])])]),a("h3",{attrs:{id:"示例-4-关闭资源服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-4-关闭资源服务器"}},[t._v("#")]),t._v(" 示例 4：关闭资源服务器")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"_7-与授权服务器配置对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-与授权服务器配置对比"}},[t._v("#")]),t._v(" 7. 与授权服务器配置对比")]),t._v(" "),a("p",[a("strong",[t._v("授权服务器")]),t._v("和"),a("strong",[t._v("资源服务器")]),t._v("：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("配置")]),t._v(" "),a("th",[t._v("前缀")]),t._v(" "),a("th",[t._v("用途")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("授权服务器")]),t._v(" "),a("td",[a("code",[t._v("spring.security.oauth2.authorization-server")])]),t._v(" "),a("td",[t._v("签发 Token")])]),t._v(" "),a("tr",[a("td",[t._v("资源服务器")]),t._v(" "),a("td",[a("code",[t._v("spring.security.oauth2.resource-server")])]),t._v(" "),a("td",[t._v("验证 Token、保护资源")])])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 授权服务器：负责认证和签发令牌")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authorization-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ... 客户端配置")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 资源服务器：负责验证令牌和保护 API")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request-matcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ignore-patterns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ... 忽略认证的路径")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"_8-安全建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-安全建议"}},[t._v("#")]),t._v(" 8. 安全建议")]),t._v(" "),a("blockquote",[a("p",[t._v("[!WARNING]\n请注意以下安全事项")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("建议")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("最小化公开端点")]),t._v(" "),a("td",[t._v("仅开放必要的公开接口")])]),t._v(" "),a("tr",[a("td",[t._v("生产环境禁用文档")]),t._v(" "),a("td",[t._v("生产环境应关闭 "),a("code",[t._v("/v3/api-docs/**")]),t._v("、"),a("code",[t._v("/doc.html")])])]),t._v(" "),a("tr",[a("td",[t._v("验证码接口限流")]),t._v(" "),a("td",[t._v("对 "),a("code",[t._v("/v1/captchas/send/*")]),t._v(" 添加限流保护")])]),t._v(" "),a("tr",[a("td",[t._v("监控端点保护")]),t._v(" "),a("td",[t._v("考虑对 "),a("code",[t._v("/actuator/**")]),t._v(" 添加 IP 白名单")])])])]),t._v(" "),a("h3",{attrs:{id:"生产环境推荐配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产环境推荐配置"}},[t._v("#")]),t._v(" 生产环境推荐配置")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("oauth2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request-matcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ignore-patterns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 仅保留必要端点")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /actuator/health=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /error=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("uuid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/secrets=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("POST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/send/mail=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/captchas/send/mobile=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DELETE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /v1/tokens=laokou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n")])])]),a("hr"),t._v(" "),a("h2",{attrs:{id:"_9-相关链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-相关链接"}},[t._v("#")]),t._v(" 9. 相关链接")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Security OAuth2 Resource Server"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("我是老寇，我们下次再见啦！")])])}),[],!1,null,null,null);a.default=n.exports}}]);