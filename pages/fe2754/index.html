<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分布式链路跟踪之ELK日志 | KCloud-Platform-IoT</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="一个企业级微服务架构的IoT云平台">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.db8bc6bf.css" as="style"><link rel="preload" href="/assets/js/app.7e8fe988.js" as="script"><link rel="preload" href="/assets/js/4.4f7bedaf.js" as="script"><link rel="preload" href="/assets/js/1.1a35546a.js" as="script"><link rel="preload" href="/assets/js/3.24701e2c.js" as="script"><link rel="preload" href="/assets/js/60.c997424b.js" as="script"><link rel="prefetch" href="/assets/js/10.226a7f24.js"><link rel="prefetch" href="/assets/js/11.d579242f.js"><link rel="prefetch" href="/assets/js/12.959b2129.js"><link rel="prefetch" href="/assets/js/13.a7c60c7b.js"><link rel="prefetch" href="/assets/js/14.64fde20d.js"><link rel="prefetch" href="/assets/js/15.7ba6b89c.js"><link rel="prefetch" href="/assets/js/16.005d26d1.js"><link rel="prefetch" href="/assets/js/17.6347af96.js"><link rel="prefetch" href="/assets/js/18.327f5160.js"><link rel="prefetch" href="/assets/js/19.850b3560.js"><link rel="prefetch" href="/assets/js/2.0aec17dd.js"><link rel="prefetch" href="/assets/js/20.1edda451.js"><link rel="prefetch" href="/assets/js/21.cdf8d4fc.js"><link rel="prefetch" href="/assets/js/22.5612e424.js"><link rel="prefetch" href="/assets/js/23.24e1fdea.js"><link rel="prefetch" href="/assets/js/24.ce68475a.js"><link rel="prefetch" href="/assets/js/25.15f6ae2f.js"><link rel="prefetch" href="/assets/js/26.23eeb1d8.js"><link rel="prefetch" href="/assets/js/27.fc7db4ad.js"><link rel="prefetch" href="/assets/js/28.b5e82490.js"><link rel="prefetch" href="/assets/js/29.a00baa1a.js"><link rel="prefetch" href="/assets/js/30.6e87f12c.js"><link rel="prefetch" href="/assets/js/31.47a4fdf6.js"><link rel="prefetch" href="/assets/js/32.0afda045.js"><link rel="prefetch" href="/assets/js/33.6147873c.js"><link rel="prefetch" href="/assets/js/34.d665d1e8.js"><link rel="prefetch" href="/assets/js/35.ddec86ce.js"><link rel="prefetch" href="/assets/js/36.c5324535.js"><link rel="prefetch" href="/assets/js/37.aede86b1.js"><link rel="prefetch" href="/assets/js/38.19f3ea57.js"><link rel="prefetch" href="/assets/js/39.96d1fb13.js"><link rel="prefetch" href="/assets/js/40.2c3479f7.js"><link rel="prefetch" href="/assets/js/41.0a55b3f0.js"><link rel="prefetch" href="/assets/js/42.6779a7a1.js"><link rel="prefetch" href="/assets/js/43.c8f87a81.js"><link rel="prefetch" href="/assets/js/44.5a19a428.js"><link rel="prefetch" href="/assets/js/45.21bd24a7.js"><link rel="prefetch" href="/assets/js/46.5a2de77f.js"><link rel="prefetch" href="/assets/js/47.c7a27f02.js"><link rel="prefetch" href="/assets/js/48.344f8880.js"><link rel="prefetch" href="/assets/js/49.ad140549.js"><link rel="prefetch" href="/assets/js/5.b1597e25.js"><link rel="prefetch" href="/assets/js/50.c2b23490.js"><link rel="prefetch" href="/assets/js/51.ac49d1ea.js"><link rel="prefetch" href="/assets/js/52.39f0bacb.js"><link rel="prefetch" href="/assets/js/53.5d0977c4.js"><link rel="prefetch" href="/assets/js/54.2e87ab9e.js"><link rel="prefetch" href="/assets/js/55.8cb918bc.js"><link rel="prefetch" href="/assets/js/56.3d52973c.js"><link rel="prefetch" href="/assets/js/57.f7d9a123.js"><link rel="prefetch" href="/assets/js/58.450df858.js"><link rel="prefetch" href="/assets/js/59.708dcfb7.js"><link rel="prefetch" href="/assets/js/6.d888edc0.js"><link rel="prefetch" href="/assets/js/61.10375f47.js"><link rel="prefetch" href="/assets/js/62.17c7cb06.js"><link rel="prefetch" href="/assets/js/63.4917406c.js"><link rel="prefetch" href="/assets/js/64.7e08fda1.js"><link rel="prefetch" href="/assets/js/65.af1f1a72.js"><link rel="prefetch" href="/assets/js/66.18d84a80.js"><link rel="prefetch" href="/assets/js/67.6cc3b336.js"><link rel="prefetch" href="/assets/js/68.a3d921dd.js"><link rel="prefetch" href="/assets/js/69.a939663d.js"><link rel="prefetch" href="/assets/js/7.1048fd35.js"><link rel="prefetch" href="/assets/js/70.d019f416.js"><link rel="prefetch" href="/assets/js/71.cb545d7a.js"><link rel="prefetch" href="/assets/js/72.241e2882.js"><link rel="prefetch" href="/assets/js/73.4bc016d8.js"><link rel="prefetch" href="/assets/js/74.87dc8114.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.9268c32e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.db8bc6bf.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="KCloud-Platform-IoT" class="logo"> <span class="site-name can-hide">KCloud-Platform-IoT</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/pages/a2f161/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>开发手册</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2332b5/" class="nav-link">工具类-必读</a></li></ul></li><li class="dropdown-item"><h4>环境搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a2f161/" class="nav-link">Centos7安装Mysql 8.0.33（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/90401a/" class="nav-link">Centos7安装Redis 7.0.11（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/0fb88c/" class="nav-link">Centos7安装RocketMQ 5.1.1（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/65acfd/" class="nav-link">Centos7安装Jdk 17.0.7（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/65acff/" class="nav-link">Centos7安装Docker 23.0.6（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/d715cf/" class="nav-link">Centos7安装Elasticsearch 8.6.2（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/552b64/" class="nav-link">Docker安装RabbitMQ 3.12.2（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/d715cb/" class="nav-link">Docker安装Postgresql 16.1（傻瓜式安装）</a></li></ul></li><li class="dropdown-item"><h4>常用命令</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/76bfa2/" class="nav-link">Centos7常用命令（傻瓜式笔记）</a></li><li class="dropdown-subitem"><a href="/pages/2f475f/" class="nav-link">Centos7常用命令（傻瓜式笔记）</a></li></ul></li><li class="dropdown-item"><h4>快速上手</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/10bfa2/" class="nav-link">环境搭建</a></li><li class="dropdown-subitem"><a href="/pages/10bfa7/" class="nav-link">项目启动</a></li></ul></li><li class="dropdown-item"><h4>前端指南</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a5d759/" class="nav-link">前端启动</a></li></ul></li><li class="dropdown-item"><h4>后端指南</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/59afe2/" class="nav-link">COLA代码规范</a></li><li class="dropdown-subitem"><a href="/pages/10bfa8/" class="nav-link">SSL证书</a></li><li class="dropdown-subitem"><a href="/pages/10bfa9/" class="nav-link">一键修改项目模块</a></li><li class="dropdown-subitem"><a href="/pages/1e1e32/" class="nav-link">一键生成项目骨架</a></li><li class="dropdown-subitem"><a href="/pages/77f103/" class="nav-link">一键修改项目版本号</a></li><li class="dropdown-subitem"><a href="/pages/843853/" class="nav-link">一键跳过测试用例</a></li><li class="dropdown-subitem"><a href="/pages/889fdb/" class="nav-link">一键生成后端COLA代码</a></li><li class="dropdown-subitem"><a href="/pages/fe2754/" aria-current="page" class="nav-link router-link-exact-active router-link-active">分布式链路跟踪之ELK日志</a></li><li class="dropdown-subitem"><a href="/pages/cf6984/" class="nav-link">一键检查代码规范</a></li><li class="dropdown-subitem"><a href="/pages/4bce44/" class="nav-link">动态路由</a></li></ul></li><li class="dropdown-item"><h4>项目部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/61389d/" class="nav-link">项目部署之镜像打包与推送</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/643da2/" class="nav-link">Java如何快速转Go</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="摘抄" class="dropdown-title"><a href="/pages/85233a/" class="link-title">摘抄</a> <span class="title" style="display:none;">摘抄</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>儒学</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/85233a/" class="nav-link">儒学摘抄（一）</a></li></ul></li><li class="dropdown-item"><h4>禅语</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/59b0b4/" class="nav-link">禅语摘抄（一）</a></li></ul></li><li class="dropdown-item"><h4>诗词</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f8adf5/" class="nav-link">诗词摘抄（一）</a></li></ul></li><li class="dropdown-item"><h4>道法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e03540/" class="nav-link">道法摘抄（一）</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="感悟" class="dropdown-title"><a href="/pages/623577/" class="link-title">感悟</a> <span class="title" style="display:none;">感悟</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>读后感</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/623577/" class="nav-link">读《强者，都是含泪奔跑的人》读后感</a></li></ul></li><li class="dropdown-item"><h4>修行</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/623578/" class="nav-link">修身/养生/情感</a></li></ul></li><li class="dropdown-item"><h4>觉悟</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b5ee4c/" class="nav-link">觉悟日记（一）</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/1b12ed/" class="nav-link">赞助</a></div><div class="nav-item"><a href="https://koushenhai.github.io/KCloud-Platform-IoT" target="_blank" rel="noopener noreferrer" class="nav-link external">
  项目课程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/KouShenhai/KCloud-Platform-IoT" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/pages/a2f161/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>开发手册</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2332b5/" class="nav-link">工具类-必读</a></li></ul></li><li class="dropdown-item"><h4>环境搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a2f161/" class="nav-link">Centos7安装Mysql 8.0.33（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/90401a/" class="nav-link">Centos7安装Redis 7.0.11（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/0fb88c/" class="nav-link">Centos7安装RocketMQ 5.1.1（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/65acfd/" class="nav-link">Centos7安装Jdk 17.0.7（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/65acff/" class="nav-link">Centos7安装Docker 23.0.6（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/d715cf/" class="nav-link">Centos7安装Elasticsearch 8.6.2（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/552b64/" class="nav-link">Docker安装RabbitMQ 3.12.2（傻瓜式安装）</a></li><li class="dropdown-subitem"><a href="/pages/d715cb/" class="nav-link">Docker安装Postgresql 16.1（傻瓜式安装）</a></li></ul></li><li class="dropdown-item"><h4>常用命令</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/76bfa2/" class="nav-link">Centos7常用命令（傻瓜式笔记）</a></li><li class="dropdown-subitem"><a href="/pages/2f475f/" class="nav-link">Centos7常用命令（傻瓜式笔记）</a></li></ul></li><li class="dropdown-item"><h4>快速上手</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/10bfa2/" class="nav-link">环境搭建</a></li><li class="dropdown-subitem"><a href="/pages/10bfa7/" class="nav-link">项目启动</a></li></ul></li><li class="dropdown-item"><h4>前端指南</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a5d759/" class="nav-link">前端启动</a></li></ul></li><li class="dropdown-item"><h4>后端指南</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/59afe2/" class="nav-link">COLA代码规范</a></li><li class="dropdown-subitem"><a href="/pages/10bfa8/" class="nav-link">SSL证书</a></li><li class="dropdown-subitem"><a href="/pages/10bfa9/" class="nav-link">一键修改项目模块</a></li><li class="dropdown-subitem"><a href="/pages/1e1e32/" class="nav-link">一键生成项目骨架</a></li><li class="dropdown-subitem"><a href="/pages/77f103/" class="nav-link">一键修改项目版本号</a></li><li class="dropdown-subitem"><a href="/pages/843853/" class="nav-link">一键跳过测试用例</a></li><li class="dropdown-subitem"><a href="/pages/889fdb/" class="nav-link">一键生成后端COLA代码</a></li><li class="dropdown-subitem"><a href="/pages/fe2754/" aria-current="page" class="nav-link router-link-exact-active router-link-active">分布式链路跟踪之ELK日志</a></li><li class="dropdown-subitem"><a href="/pages/cf6984/" class="nav-link">一键检查代码规范</a></li><li class="dropdown-subitem"><a href="/pages/4bce44/" class="nav-link">动态路由</a></li></ul></li><li class="dropdown-item"><h4>项目部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/61389d/" class="nav-link">项目部署之镜像打包与推送</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/643da2/" class="nav-link">Java如何快速转Go</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="摘抄" class="dropdown-title"><a href="/pages/85233a/" class="link-title">摘抄</a> <span class="title" style="display:none;">摘抄</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>儒学</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/85233a/" class="nav-link">儒学摘抄（一）</a></li></ul></li><li class="dropdown-item"><h4>禅语</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/59b0b4/" class="nav-link">禅语摘抄（一）</a></li></ul></li><li class="dropdown-item"><h4>诗词</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f8adf5/" class="nav-link">诗词摘抄（一）</a></li></ul></li><li class="dropdown-item"><h4>道法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e03540/" class="nav-link">道法摘抄（一）</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="感悟" class="dropdown-title"><a href="/pages/623577/" class="link-title">感悟</a> <span class="title" style="display:none;">感悟</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>读后感</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/623577/" class="nav-link">读《强者，都是含泪奔跑的人》读后感</a></li></ul></li><li class="dropdown-item"><h4>修行</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/623578/" class="nav-link">修身/养生/情感</a></li></ul></li><li class="dropdown-item"><h4>觉悟</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b5ee4c/" class="nav-link">觉悟日记（一）</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/1b12ed/" class="nav-link">赞助</a></div><div class="nav-item"><a href="https://koushenhai.github.io/KCloud-Platform-IoT" target="_blank" rel="noopener noreferrer" class="nav-link external">
  项目课程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/KouShenhai/KCloud-Platform-IoT" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发手册</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/2332b5/" class="sidebar-link">工具类-必读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>环境搭建</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/a2f161/" class="sidebar-link">Centos7安装Mysql 8.0.33（傻瓜式安装）</a></li><li><a href="/pages/90401a/" class="sidebar-link">Centos7安装Redis 7.0.11（傻瓜式安装）</a></li><li><a href="/pages/0fb88c/" class="sidebar-link">Centos7安装RocketMQ 5.1.1（傻瓜式安装）</a></li><li><a href="/pages/65acfd/" class="sidebar-link">Centos7安装Jdk 17.0.7（傻瓜式安装）</a></li><li><a href="/pages/65acff/" class="sidebar-link">Centos7安装Docker 23.0.6（傻瓜式安装）</a></li><li><a href="/pages/552b64/" class="sidebar-link">Docker安装RabbitMQ 3.12.2（傻瓜式安装）</a></li><li><a href="/pages/d715cf/" class="sidebar-link">Centos7安装Elasticsearch 8.6.2（傻瓜式安装）</a></li><li><a href="/pages/d715cb/" class="sidebar-link">Docker安装Postgresql 16.1（傻瓜式安装）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>常用命令</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/76bfa2/" class="sidebar-link">Centos7常用命令（傻瓜式笔记）</a></li><li><a href="/pages/2f475f/" class="sidebar-link">Docker常用命令（傻瓜式笔记）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>快速上手</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/10bfa2/" class="sidebar-link">环境搭建</a></li><li><a href="/pages/10bfa7/" class="sidebar-link">项目启动</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/a5d759/" class="sidebar-link">前端启动</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>后端指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/59afe2/" class="sidebar-link">COLA代码规范</a></li><li><a href="/pages/10bfa8/" class="sidebar-link">SSL证书</a></li><li><a href="/pages/10bfa9/" class="sidebar-link">一键修改项目模块</a></li><li><a href="/pages/1e1e32/" class="sidebar-link">一键生成项目骨架</a></li><li><a href="/pages/77f103/" class="sidebar-link">一键修改项目版本号</a></li><li><a href="/pages/843853/" class="sidebar-link">一键跳过测试用例</a></li><li><a href="/pages/889fdb/" class="sidebar-link">一键生成后端COLA代码</a></li><li><a href="/pages/fe2754/" aria-current="page" class="active sidebar-link">分布式链路跟踪之ELK日志</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/cf6984/" class="sidebar-link">一键检查代码规范</a></li><li><a href="/pages/4bce44/" class="sidebar-link">动态路由</a></li><li><a href="/pages/766b36/" class="sidebar-link">OAuth2.1流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>项目部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/61389d/" class="sidebar-link">项目部署之镜像打包与推送</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/643da2/" class="sidebar-link">Java如何快速转Go</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>指南</span></li><li data-v-06225672><span data-v-06225672>后端指南</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/KouShenhai" target="_blank" title="作者" class="beLink" data-v-06225672>KCloud-Platform-IoT</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">分布式链路跟踪之ELK日志<!----></h1>  <div class="theme-vdoing-content content__default"><p>你好呀，我的老朋友！我是老寇，欢迎来到老寇云平台！</p> <p>话不多说，讲一讲分布式链路跟踪之ELK日志！</p> <h3 id="服务治理"><a href="#服务治理" class="header-anchor">#</a> 服务治理</h3> <p>在微服务治理中，最重要的莫过于日志、链路和指标，为什么？因为微服务调用链路错综复杂，服务节点的数量成千上万，所以，基础设施建设重中之重，否则，出现问题，排查将是一大难题。</p> <h3 id="技术栈"><a href="#技术栈" class="header-anchor">#</a> 技术栈</h3> <h4 id="log4j2"><a href="#log4j2" class="header-anchor">#</a> log4j2</h4> <p><a href="https://logging.apache.org/log4j/2.x/" target="_blank" rel="noopener noreferrer">log4j2官方地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>像<code>log4j</code>、<code>logback</code>、<code>log4j2</code>都是Java日志记录框架，而slf4j是日志门面，统一日志API，隐藏具体的日志实现。</p> <p><code>log4j2</code>是<code>log4j</code>的升级版，性能卓越，支持异步日志，也是目前性能最好的Java日志记录框架。</p> <p><code>log4j2</code>不会给Java垃圾回收器带来任何负担，这是通过基于 <a href="https://lmax-exchange.github.io/disruptor/" target="_blank" rel="noopener noreferrer">LMAX Disruptor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
技术和JVM零GC实现</p> <font color="red">
注意：零gc就是无垃圾回收，log4j2复用字节数组，字符串数组等对象，不需要重复创建，减少不必要的对象创建，从而不触发gc</font> <h4 id="kafka"><a href="#kafka" class="header-anchor">#</a> kafka</h4> <p><a href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer">kafka官方地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>什么是事件流处理？</p> <p>事件流处理是 <font color="red">从事件源实时捕获数据的做法</font></p> <p>例如，从数据库，传感器，移动设备实时捕获数据，持久化存储这些这些事件流以供检索、操作和处理。</p> <p><code>kafka</code>就是一个事件流处理平台</p> <ul><li>发布（写入）和订阅（读取）事件流，包括连续导入/导出来自其他系统的数据</li> <li>根据需要持久可靠地存储事件流</li> <li>在事件发生时（实时）或回顾性地处理事件流</li></ul> <p>kafka如何工作？</p> <p><code>kafka</code>
是一个分布式系统，由服务器和客户端组成，这些服务器和客户端通过高性能 <a href="https://kafka.apache.org/protocol.html" target="_blank" rel="noopener noreferrer">TCP网络协议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
通信。</p> <h4 id="micrometer"><a href="#micrometer" class="header-anchor">#</a> micrometer</h4> <p><a href="https://docs.micrometer.io/micrometer/reference/" target="_blank" rel="noopener noreferrer">micrometer官方地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>micrometer</code>【千分尺】为最流行的可观测性系统在检测客户端提供了一个简单的外观，允许您检测基于JVM的应用程序代码，而不受供应商限制。</p> <p><font color="red">注意：Spring Cloud Sleuth 迁移至 Micrometer Tracing</font></p> <p><font color="red">micrometer是最流行的可观测性工具的应用程序可观测性外观 </font></p> <p><font color="red">tracing是提供对跟踪器和跟踪系统报告器的跟踪抽象</font></p> <font color="red">
注意：tracing官方提供对Brave和OpenTelemetry的桥接，tracing只是一个跟踪抽象，类似slf4j门面，具体的链路跟踪由Brave或OpenTelemetry来实现。</font> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencys</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 集成Brave --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing-bridge-brave<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 集成OpenTelemetry --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing-bridge-otel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencys</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Brave和OpenTelemetry区别？</p> <p><a href="https://github.com/openzipkin/brave" target="_blank" rel="noopener noreferrer">Brave代码地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>Brave</code>是一个分布式链路跟踪插桩库。通过拦截请求的方式收集时序数据并通过链路标识来关联传播。
通常会将链路跟踪数据发送到<code>Zipkin</code>，也可以使用第三方插件方式发送到其他替代服务。</p> <p><code>Brave</code>提供的API，配置选项较少，但其集成比较简单，适合不需要复杂自定义的场景。</p> <p><code>Brave</code>主要是围绕<code>Zipkin</code>的生态发展，尽管稳定且成熟，但还是有一定的局限性。</p> <hr> <p><a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer">OpenTelemetry官方地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>OpenTelemetry是未来的观测标准【本项目就是使用这个标准，来收集指标和链路】。 提供更广泛的API和配置选项，支持更多自定义的操作，适合需要高度可扩展性和灵活性的应用。</p> <p>可以用它来检测，生成，收集和导出观测数据【指标、日志和跟踪（链路）】，可以用来分析软件的性能和行为。</p> <p>更重要是该项目是一个活跃且快速发展的项目，并且得到更广泛的行业支持，具有更广泛的社区支持和更丰富的生态系统，蕴盖了多个云供应商和监控工具。</p> <h4 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> elasticsearch</h4> <p><a href="https://www.elastic.co/cn/elasticsearch" target="_blank" rel="noopener noreferrer">elasticsearch官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>elasticsearch</code>是一个分布式、RESTFul风格的搜索和数据分析引擎，同时是可扩展的数据存储和矢量数据库，能够应对日益增多的各种用例。</p> <p><font color="red">注意：什么是矢量？我个人的理解是对某种事物的特征描述，通过特征描述可以大致还原出整个事物</font></p> <p><code>elasticsearch</code>能够存储海量数据，实现闪电般的搜索速度，精细的相关性调整以及强大的分析能力，并且能够轻松进行规模扩展。</p> <h4 id="beats"><a href="#beats" class="header-anchor">#</a> beats</h4> <p><a href="https://www.elastic.co/cn/beats" target="_blank" rel="noopener noreferrer">beats官方地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>beats</code>是一个免费且开发的平台，集成了多种单一用途数据采集器。它们从成百上千或成千上万台机器和系统向<code>Logstash</code>
或<code>Elasticsearch</code>发送数据。</p> <h5 id="filebeat"><a href="#filebeat" class="header-anchor">#</a> filebeat</h5> <p><a href="https://www.elastic.co/cn/beats/filebeat" target="_blank" rel="noopener noreferrer">filebeat官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>filebeat</code>是使用<code>go</code>语言开发的，用于转发和汇总日志与文件，让简单的事情不再繁杂。</p> <h4 id="logstash"><a href="#logstash" class="header-anchor">#</a> logstash</h4> <p><a href="https://www.elastic.co/guide/en/logstash/current/introduction.html" target="_blank" rel="noopener noreferrer">logstash官方地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>logstash</code>是一个开源数据收集引擎，具有流水线功能，可以动态接收来自不同数据源的数据，并将数据按照一定的规则进行数据清洗，然后写入对应的目标数据源。</p> <p>任何类型事件可以通过广泛的<code>input</code>、<code>output</code>、<code>filter</code>插件来进行清洗和转换，丰富的编解码器进一步简化开发。</p> <font color="red">
注意：logstash资源消耗大，占用CPU和内存高，没有消息队列缓存，会有丢失消息的风险，因此，本项目自行写了一个轻量级的服务，用来清洗数据，写入ES。</font> <h4 id="kibana"><a href="#kibana" class="header-anchor">#</a> kibana</h4> <p><a href="https://www.elastic.co/guide/en/kibana/current/introduction.html" target="_blank" rel="noopener noreferrer">kibana官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>kibana</code>是一个用户界面，可让您可视化Elasticsearch数据并管理ElasticStack。</p> <ul><li>搜索文档，分析文档和查找安全漏洞</li> <li>数据可视化</li> <li>管理，监控Elastic Stack集群，以及权限控制</li></ul> <h4 id="elastic-stack"><a href="#elastic-stack" class="header-anchor">#</a> Elastic Stack</h4> <p><code>Elastic Stack</code>的核心产品包括 Elasticsearch、Kibana、Beats 和 Logstash</p> <p>ELK = Elasticsearch + Logstash + Kibana</p> <p>EFK = Elasticsearch + Filebeat + Logstash + Kibana</p> <img src="/img/分布式链路跟踪之ELK日志/img.png"> <h3 id="安装elk"><a href="#安装elk" class="header-anchor">#</a> 安装ELK</h3> <p><a href="https://kcloud.blog.csdn.net/article/details/138465258" target="_blank" rel="noopener noreferrer">请参考es+kibana安装教程,请一定要使用这个链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
	<span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
		<span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/elasticsearch/elasticsearch<span class="token punctuation">:</span>8.15.0
		<span class="token key atrule">container_name</span><span class="token punctuation">:</span> elasticsearch
		<span class="token comment"># 保持容器在没有守护程序的情况下运行</span>
		<span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
		<span class="token key atrule">restart</span><span class="token punctuation">:</span> always
		<span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
		<span class="token key atrule">ports</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span> <span class="token string">&quot;9200:9200&quot;</span>
			<span class="token punctuation">-</span> <span class="token string">&quot;9300:9300&quot;</span>
		<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span> ./elasticsearch8/config/elasticsearch.yml<span class="token punctuation">:</span>/usr/share/elasticsearch/config/elasticsearch.yml
			<span class="token punctuation">-</span> ./elasticsearch8/data<span class="token punctuation">:</span>/usr/share/elasticsearch/data
			<span class="token punctuation">-</span> ./elasticsearch8/logs<span class="token punctuation">:</span>/usr/share/elasticsearch/logs
			<span class="token punctuation">-</span> ./elasticsearch8/plugins<span class="token punctuation">:</span>/usr/share/elasticsearch/plugins
			<span class="token punctuation">-</span> ./elasticsearch8/config/certs/elastic<span class="token punctuation">-</span>certificates.p12<span class="token punctuation">:</span>/usr/share/elasticsearch/config/certs/elastic<span class="token punctuation">-</span>certificates.p12
		<span class="token key atrule">environment</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span> TZ=Asia/Shanghai
			<span class="token punctuation">-</span> ES_JAVA_OPTS=<span class="token punctuation">-</span>Xmx1g <span class="token punctuation">-</span>Xms1g
			<span class="token punctuation">-</span> ELASTIC_PASSWORD=laokou123
		<span class="token key atrule">networks</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span> laokou_network
		<span class="token key atrule">ulimits</span><span class="token punctuation">:</span>
			<span class="token key atrule">memlock</span><span class="token punctuation">:</span>
				<span class="token key atrule">soft</span><span class="token punctuation">:</span> <span class="token number">-1</span>
				<span class="token key atrule">hard</span><span class="token punctuation">:</span> <span class="token number">-1</span>
	<span class="token key atrule">kibana</span><span class="token punctuation">:</span>
		<span class="token key atrule">image</span><span class="token punctuation">:</span> kibana<span class="token punctuation">:</span>8.15.0
		<span class="token key atrule">container_name</span><span class="token punctuation">:</span> kibana
		<span class="token comment"># 保持容器在没有守护程序的情况下运行</span>
		<span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
		<span class="token key atrule">restart</span><span class="token punctuation">:</span> always
		<span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
		<span class="token key atrule">environment</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span> TZ=Asia/Shanghai
		<span class="token key atrule">ports</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span> <span class="token string">&quot;5601:5601&quot;</span>
		<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span> ./kibana8/config/kibana.yml<span class="token punctuation">:</span>/usr/share/kibana/config/kibana.yml
		<span class="token key atrule">networks</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span> laokou_network
		<span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span> elasticsearch
		<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
			<span class="token key atrule">resources</span><span class="token punctuation">:</span>
				<span class="token key atrule">limits</span><span class="token punctuation">:</span>
					<span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">'0.50'</span>
					<span class="token key atrule">memory</span><span class="token punctuation">:</span> 1G

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
	<span class="token key atrule">laokou_network</span><span class="token punctuation">:</span>
		<span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
</code></pre></div><p>kibana.yaml配置</p> <div class="language-shell extra-class"><pre class="language-shell"><code>server.name: kibana
server.host: <span class="token number">0.0</span>.0.0
server.port: <span class="token number">5601</span>
server.ssl.enabled: <span class="token boolean">false</span>
elasticsearch.hosts: <span class="token punctuation">[</span> <span class="token string">&quot;https://elasticsearch:9200&quot;</span> <span class="token punctuation">]</span>
monitoring.ui.container.elasticsearch.enabled: <span class="token boolean">true</span>
elasticsearch.ssl.verificationMode: none
elasticsearch.username: <span class="token string">&quot;kibana_system&quot;</span>
elasticsearch.password: <span class="token string">&quot;laokou123&quot;</span>
i18n.locale: zh-CN
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 从docker进入Linux系统</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> elasticsearch /bin/bash

<span class="token builtin class-name">cd</span> /usr/share/elasticsearch

<span class="token comment"># 设置kibana密码</span>
./bin/elasticsearch-setup-passwords interactive
<span class="token comment"># 移除容器，重新启动</span>
<span class="token function">docker-compose</span> stop elasticsearch kibaba
<span class="token function">docker-compose</span> <span class="token function">rm</span>
<span class="token comment"># 重启</span>
<span class="token function">docker-compose</span> restart elasticsearch kibaba
</code></pre></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <h4 id="log4j2使用"><a href="#log4j2使用" class="header-anchor">#</a> log4j2使用</h4> <p>引入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencys</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- log4j2的AsyncLogger时需要包含disruptor --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.lmax<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>disruptor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-log4j2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencys</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>开启异步日志，请创建<code>log4j2.component.properties</code></p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">log4jContextSelector</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.logging.log4j.core.async.AsyncLoggerContextSelector</span>
</code></pre></div><p><font color="red">注意：请切换至prod环境</font></p> <p>log4j2配置</p> <p>以auth服务为例</p> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ERROR<span class="token punctuation">&quot;</span></span> <span class="token attr-name">monitorInterval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- 变量配置 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Properties</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 存放目录 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOG_PATH<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/opt/auth<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token comment">&lt;!-- 日志文件大小 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOG_ROLL_SIZE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1 GB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token comment">&lt;!-- 服务名称 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SERVICE_ID<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>laokou-auth<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token comment">&lt;!-- -Dlog4j.skipJansi=false --&gt;</span>
		<span class="token comment">&lt;!-- 日志格式 --&gt;</span>
		<span class="token comment">&lt;!--
			%d 日期
			%t 线程

			对于系统参数，使用${sys:xxx}即可，例如读取-Dserver.port=1111，即${sys:server.port}
			spanId  =&gt; %X{spanId}
			traceId =&gt; %X{traceId}
		--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOG_CONSOLE_PATTERN<span class="token punctuation">&quot;</span></span>
				  <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} ---&gt; [${SERVICE_ID} - ${sys:ip}:${sys:server.port}] - [%X{traceId}] - [%X{spanId}] - [ %style{%-5level}{red}] - [%t] - %logger : %msg%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOG_FILE_PATTERN<span class="token punctuation">&quot;</span></span>
				  <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} ---&gt; [${SERVICE_ID} - ${sys:ip}:${sys:server.port}] - [%X{traceId}] - [%X{spanId}] - [ %-5level] - [%t] - %logger : %msg%n<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token comment">&lt;!-- 日志保留30天 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOG_DAYS<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token comment">&lt;!-- 1天滚动一次 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOG_INTERVAL<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Properties</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Appenders</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 控制台输出 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>console<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SYSTEM_OUT<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_CONSOLE_PATTERN}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Console</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingRandomAccessFile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_PATH}/${SERVICE_ID}.log<span class="token punctuation">&quot;</span></span>
								 <span class="token attr-name">filePattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_PATH}/%d{yyyyMMdd}/${SERVICE_ID}_%d{yyyy-MM-dd}.%i.log.gz<span class="token punctuation">&quot;</span></span>
								 <span class="token attr-name">immediateFlush</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Filters</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThresholdFilter</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ERROR<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Filters</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_FILE_PATTERN}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeBasedTriggeringPolicy</span> <span class="token attr-name">interval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_INTERVAL}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SizeBasedTriggeringPolicy</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_ROLL_SIZE}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DefaultRolloverStrategy</span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_DAYS}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingRandomAccessFile</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RollingRandomAccessFile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>failover_kafka<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_PATH}/${SERVICE_ID}_kafka.log<span class="token punctuation">&quot;</span></span>
								 <span class="token attr-name">filePattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_PATH}/%d{yyyyMMdd}/${SERVICE_ID}_kafka_%d{yyyy-MM-dd}.%i.log.gz<span class="token punctuation">&quot;</span></span>
								 <span class="token attr-name">immediateFlush</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Filters</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThresholdFilter</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMatch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ACCEPT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onMismatch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DENY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Filters</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_FILE_PATTERN}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Policies</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TimeBasedTriggeringPolicy</span> <span class="token attr-name">interval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_INTERVAL}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SizeBasedTriggeringPolicy</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_ROLL_SIZE}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Policies</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DefaultRolloverStrategy</span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${LOG_DAYS}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RollingRandomAccessFile</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Failover</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>failover<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primary</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>kafka<span class="token punctuation">&quot;</span></span> <span class="token attr-name">retryIntervalSeconds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>600<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Failovers</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>failover_kafka<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Failovers</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Failover</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Async</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>async_file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bufferSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">blocking</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Async</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Async</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>async_kafka<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bufferSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">blocking</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>failover<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Async</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Kafka</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>kafka<span class="token punctuation">&quot;</span></span> <span class="token attr-name">topic</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>laokou_trace_topic<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreExceptions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span><span class="token punctuation">&gt;</span></span>
				<span class="token comment">&lt;!--

				   注意：真实的生产环境，日志打印的内容是五花八门，日志内容会出现一些莫名其他的特殊符号，导致json无法反序列化
				   因此，可以利用Pattern Layout 提供的标签enc，enc支持4种转义，HTML/XML/JSON/CRLF，默认进行HTML转义
				  目前，只对JSON处理，即%enc{%m}{JSON} =&gt; {&quot;msg&quot;:&quot;%enc{%m}{JSON}&quot;}

				--&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>
					{
					&quot;serviceId&quot;:&quot;${SERVICE_ID}&quot;,
					&quot;profile&quot;:&quot;prod&quot;,
					&quot;dateTime&quot;:&quot;%d{yyyy-MM-dd HH:mm:ss.SSS}&quot;,
					&quot;traceId&quot;:&quot;%X{traceId}&quot;,
					&quot;spanId&quot;:&quot;%X{spanId}&quot;,
					&quot;address&quot;:&quot;${sys:ip}:${sys:server.port}&quot;,
					&quot;level&quot;:&quot;%-5level&quot;,
					&quot;thread&quot;:&quot;%thread&quot;,
					&quot;logger&quot;:&quot;%logger&quot;,
					&quot;msg&quot;:&quot;%enc{%m}{JSON}&quot;
					}
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PatternLayout</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 生产者发送消息最大阻塞时间，单位为毫秒，生产者阻塞超过2秒，则抛出异常并中断发送【生产者内部缓冲区已满或元数据不可用，send()会阻塞等待】 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>max.block.ms<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Property</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 客户端发送请求到kafka broker超时时间，单位为毫秒，2秒内没有从kafka broker收到响应，则认为请求失败则抛出异常 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>request.timeout.ms<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Property</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bootstrap.servers<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>kafka:9092<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Property</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Kafka</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Appenders</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--
	 	additivity      =&gt; 需不需要打印此logger继承的父logger，false只打印当前logger，true继续打印上一层logger，直至root
	 	includeLocation =&gt; 显示文件行数，方法名等信息，true显示，false不显示，可以减少日志输出的体积，加快日志写入速度
	 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AsyncLogger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.laokou<span class="token punctuation">&quot;</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FALSE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">includeLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FALSE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>async_kafka<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AsyncLogger</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AsyncRoot</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ERROR<span class="token punctuation">&quot;</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FALSE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">includeLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FALSE<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>console<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>async_file<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AsyncRoot</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="micrometer使用"><a href="#micrometer使用" class="header-anchor">#</a> micrometer使用</h4> <p>依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencys</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing-bridge-otel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- openfeign集成micrometer --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencys</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TraceUtil</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Tracer</span> tracer<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTraceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">TraceContext</span> context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">traceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSpanId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">TraceContext</span> context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">spanId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">TraceContext</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> tracer<span class="token punctuation">.</span><span class="token function">currentTraceContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="elasticsearch使用"><a href="#elasticsearch使用" class="header-anchor">#</a> elasticsearch使用</h4> <p>引入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>co.elastic.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>异步创建索引和批量同步索引【详情请查看本项目源码，laokou-common-elasticsearch】</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ElasticsearchTemplate</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ElasticsearchAsyncClient</span> elasticsearchAsyncClient<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@SneakyThrows</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TDocument</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">asyncCreateIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> alias<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TDocument</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">asyncExist</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>resp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>resp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;索引：{} -&gt; 创建索引失败，索引已存在&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">FALSE</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>resp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>resp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
				elasticsearchAsyncClient<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token function">getCreateIndexRequest</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>response <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">acknowledged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;索引：{} -&gt; 创建索引成功&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
						log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;索引：{} -&gt; 创建索引失败&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">FALSE</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">FALSE</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@SneakyThrows</span>
	<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">asyncBulkCreateDocument</span><span class="token punctuation">(</span><span class="token class-name">String</span> index<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> elasticsearchAsyncClient
			<span class="token punctuation">.</span><span class="token function">bulk</span><span class="token punctuation">(</span>bulk <span class="token operator">-&gt;</span> bulk<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token class-name">Refresh<span class="token punctuation">.</span>True</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">operations</span><span class="token punctuation">(</span><span class="token function">getBulkOperations</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>resp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;索引：{} -&gt; 异步批量同步索引失败&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">FALSE</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;索引：{} -&gt; 异步批量同步索引成功&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="logstash使用"><a href="#logstash使用" class="header-anchor">#</a> logstash使用</h4> <p><font color="red">注意：logstash是用的本项目自己搞的轻量级日志收集引擎</font></p> <p>核心源码</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TraceHandler</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TRACE</span> <span class="token operator">=</span> <span class="token string">&quot;laokou_trace&quot;</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ElasticsearchTemplate</span> elasticsearchTemplate<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">&quot;laokou_trace_topic&quot;</span><span class="token punctuation">,</span> groupId <span class="token operator">=</span> <span class="token string">&quot;laokou_trace_consumer_group&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">kafkaConsumer</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">,</span> <span class="token class-name">Acknowledgment</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataMap <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">getTraceIndex</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token operator">::</span><span class="token function">nonNull</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">TraceIndex</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> traceIndex <span class="token operator">-&gt;</span> traceIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				elasticsearchTemplate<span class="token punctuation">.</span><span class="token function">asyncCreateIndex</span><span class="token punctuation">(</span><span class="token function">getIndexName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">TRACE</span><span class="token punctuation">,</span> <span class="token class-name">TraceIndex</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> elasticsearchTemplate<span class="token punctuation">.</span><span class="token function">asyncBulkCreateDocument</span><span class="token punctuation">(</span><span class="token function">getIndexName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;分布式链路写入失败，错误信息：{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
			ack<span class="token punctuation">.</span><span class="token function">acknowledge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">TraceIndex</span> <span class="token function">getTraceIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">TraceIndex</span> traceIndex <span class="token operator">=</span> <span class="token class-name">JacksonUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token class-name">TraceIndex</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">String</span> traceId <span class="token operator">=</span> traceIndex<span class="token punctuation">.</span><span class="token function">getTraceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">String</span> spanId <span class="token operator">=</span> traceIndex<span class="token punctuation">.</span><span class="token function">getSpanId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrace</span><span class="token punctuation">(</span>traceId<span class="token punctuation">,</span> spanId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				traceIndex<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">IdGenerator</span><span class="token punctuation">.</span><span class="token function">defaultSnowflakeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> traceIndex<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;分布式链路日志JSON转换失败，错误信息：{}&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isTrace</span><span class="token punctuation">(</span><span class="token class-name">String</span> traceId<span class="token punctuation">,</span> <span class="token class-name">String</span> spanId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">isTrace</span><span class="token punctuation">(</span>traceId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isTrace</span><span class="token punctuation">(</span>spanId<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isTrace</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>str<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;${&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>str<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getIndexName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token constant">TRACE</span> <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">nowDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;yyyyMMdd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Data</span>
	<span class="token annotation punctuation">@Index</span><span class="token punctuation">(</span>setting <span class="token operator">=</span> <span class="token annotation punctuation">@Setting</span><span class="token punctuation">(</span>refreshInterval <span class="token operator">=</span> <span class="token string">&quot;-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TraceIndex</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">LONG</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> serviceId<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> profile<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span> format <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> dateTime<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> traceId<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> spanId<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> level<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> thread<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> logger<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="kibana使用"><a href="#kibana使用" class="header-anchor">#</a> kibana使用</h4> <p>1.启动nacos/snail job/sentinel/auth/gateway/logstash</p> <p>2.运行auth测试用例
<img src="/img/分布式链路跟踪之ELK日志/img_1.png"></p> <p>3.打开kibana控制台</p> <p>输入设置好的账号密码 =&gt; elastic/laokou123</p> <img src="/img/分布式链路跟踪之ELK日志/img_2.png"> <img src="/img/分布式链路跟踪之ELK日志/img_3.png"> <img src="/img/分布式链路跟踪之ELK日志/img_4.png"> <img src="/img/分布式链路跟踪之ELK日志/img_5.png"> <img src="/img/分布式链路跟踪之ELK日志/img_6.png"> <p><font color="red">补充</font></p> <p>本项目使用分布链路跟踪，只需要引入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.laokou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>laokou-common-trace<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>至此，大功告成，恭喜你看完分布式链路跟踪之ELK日志，你学废了码？</p> <p>我是老寇，我们下次再见啦！</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">12/3/2024, 4:58:18 AM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/889fdb/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">一键生成后端COLA代码</div></a> <a href="/pages/cf6984/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">一键检查代码规范</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/889fdb/" class="prev">一键生成后端COLA代码</a></span> <span class="next"><a href="/pages/cf6984/">一键检查代码规范</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:2413176044@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/KouShenhai" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2024
    <span>laokou | Apache 2.0 License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7e8fe988.js" defer></script><script src="/assets/js/4.4f7bedaf.js" defer></script><script src="/assets/js/1.1a35546a.js" defer></script><script src="/assets/js/3.24701e2c.js" defer></script><script src="/assets/js/60.c997424b.js" defer></script>
  </body>
</html>
